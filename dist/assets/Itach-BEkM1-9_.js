import{_ as M,c as v,b as r,w as a,r as c,u as T,o as d,d as i,f as h,g as I,a as _,t as u,F as A,e as S}from"./index-I83tZY5t.js";const y=""+new URL("itach-BjrxkZ7I.png",import.meta.url).href,B={name:"Itach",setup(){return{stateStore:T()}},created(){this.loadExistingConfig()},data(){return{itachIP:null,itachIPs:[],selected:"",count:[...Array(24).keys()],feedbackMessages:[],generalError:"",saveError:""}},computed:{countOptions(){return this.count.map(s=>s+1)},maxItachAllowed(){return this.selected?Math.ceil(this.selected/3):0},canAddMore(){return this.itachIPs.length<this.maxItachAllowed}},watch:{selected(){this.generalError=""},itachIP(){this.generalError&&this.itachIP&&(this.generalError="")}},methods:{async loadExistingConfig(){const s=await this.stateStore.loadItachConfig();s&&(this.itachIPs=s.itachIPs,this.selected=s.set_top_box_count)},isValidIP(s){return/^(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)){3}$/.test(s)},add(){if(this.generalError="",!this.selected){this.generalError="Please select the number of set-top boxes first";return}if(!this.canAddMore){this.generalError=`Maximum ${this.maxItachAllowed} iTach allowed for ${this.selected} set-top boxes (3 set-top boxes per iTach)`;return}this.isValidIP(this.itachIP)?(this.itachIPs.push(this.itachIP),this.itachIP="",this.generalError=""):this.generalError="Enter Valid IP Address"},trash(s){this.itachIPs.splice(s,1),this.feedbackMessages.splice(s,1)},validateItem(s){const t=this.itachIPs[s]||"";this.isValidIP(t)?this.feedbackMessages[s]="":this.feedbackMessages[s]="Invalid IP format"},async save(){if(this.saveError="",!this.selected){this.saveError="Please select the number of set-top boxes";return}if(this.itachIPs.length===0){this.saveError="Please add at least one iTach IP address";return}const s=Math.ceil(this.selected/3);if(this.itachIPs.length<s){this.saveError=`You need ${s} iTach device(s) for ${this.selected} set-top boxes (3 per iTach)`;return}let t=!1;if(this.itachIPs.forEach((n,e)=>{this.isValidIP(n)?this.feedbackMessages[e]="":(this.feedbackMessages[e]="Invalid IP format",t=!0)}),t){this.saveError="Please correct invalid IP addresses before saving";return}const b=`${location.hostname}:3000`;try{let n={};this.itachIPs.forEach((e,l)=>{n[`itach${l+1}_ipaddress`]=e}),n.set_top_box_count=this.selected,await fetch(`http://${b}/write/UserItachIPs/${JSON.stringify(n)}`),this.$router.push({name:"home"})}catch{this.saveError="Error saving configuration. Please try again."}},cancel(){this.$router.push({name:"home"})}}},U={class:"itach-container"},N={class:"field mb-4"},R={key:0,class:"text-center mt-2"},j={class:"field mb-4"},z={class:"list-grid"},L={class:"d-flex justify-space-between align-center mb-2"},O={class:"text-caption"},q={key:0,class:"feedback text-center mt-1"};function D(s,t,b,n,e,l){const w=c("v-card-title"),C=c("v-select"),p=c("v-icon"),m=c("v-btn"),P=c("v-text-field"),x=c("v-card-text"),k=c("v-card"),E=c("v-alert"),V=c("v-card-actions");return d(),v("div",U,[r(k,{class:"itach-card",elevation:"4"},{default:a(()=>[r(w,{class:"text-h6 text-center"},{default:a(()=>[...t[2]||(t[2]=[h(" Add Global Cache iTach ",-1)])]),_:1}),t[9]||(t[9]=i("div",{class:"text-center my-2"},[i("img",{src:y,alt:"iTach Device",class:"itach-image"})],-1)),r(x,null,{default:a(()=>[i("div",N,[r(C,{modelValue:e.selected,"onUpdate:modelValue":t[0]||(t[0]=f=>e.selected=f),items:l.countOptions,label:"Count of Set Top Boxes you need to IR Control - you will need 1 iTach for every 3 Set Top Boxes",variant:"outlined"},null,8,["modelValue","items"]),e.selected?(d(),v("div",R,[r(p,null,{default:a(()=>[...t[3]||(t[3]=[h("mdi-set-top-box",-1)])]),_:1}),h(" "+u(e.selected),1)])):_("",!0)]),i("div",j,[r(P,{modelValue:e.itachIP,"onUpdate:modelValue":t[1]||(t[1]=f=>e.itachIP=f),modelModifiers:{trim:!0},label:"IP Address of iTach",placeholder:"192.168.1.xx",variant:"outlined",maxlength:"15",disabled:!e.selected||!l.canAddMore,error:!!e.generalError,"error-messages":e.generalError},{"append-inner":a(()=>[r(m,{icon:"",size:"small",onClick:l.add,color:"blue",disabled:!e.selected||!l.canAddMore},{default:a(()=>[r(p,null,{default:a(()=>[...t[4]||(t[4]=[h("mdi-plus",-1)])]),_:1})]),_:1},8,["onClick","disabled"])]),_:1},8,["modelValue","disabled","error","error-messages"])]),i("div",z,[(d(!0),v(A,null,S(e.itachIPs,(f,o)=>(d(),I(k,{key:o,class:"grid-item",elevation:"1"},{default:a(()=>[r(x,{class:"pa-2"},{default:a(()=>[i("div",L,[i("label",O,"Global Cache iTach "+u(o+1),1),r(m,{icon:"",size:"x-small",onClick:g=>l.trash(o),color:"red"},{default:a(()=>[r(p,{size:"small"},{default:a(()=>[...t[5]||(t[5]=[h("mdi-delete",-1)])]),_:1})]),_:1},8,["onClick"])]),t[6]||(t[6]=i("div",{class:"text-center mb-2"},[i("img",{src:y,alt:"iTach",class:"itach-grid-image"})],-1)),r(P,{modelValue:e.itachIPs[o],"onUpdate:modelValue":g=>e.itachIPs[o]=g,variant:"outlined",density:"compact",maxlength:"15",onBlur:g=>l.validateItem(o),error:!!e.feedbackMessages[o],"hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","onBlur","error"]),e.feedbackMessages[o]?(d(),v("p",q,u(e.feedbackMessages[o]),1)):_("",!0)]),_:2},1024)]),_:2},1024))),128))]),e.selected&&e.itachIPs.length>0&&e.itachIPs.length<l.maxItachAllowed?(d(),I(E,{key:0,type:"warning",density:"compact",class:"mt-4"},{default:a(()=>[h(" You need "+u(l.maxItachAllowed-e.itachIPs.length)+" more iTach device(s). Total required: "+u(l.maxItachAllowed)+" iTach for "+u(e.selected)+" set-top boxes. ",1)]),_:1})):_("",!0),e.saveError?(d(),I(E,{key:1,type:"error",density:"compact",class:"mt-4",closable:"",icon:!1},{default:a(()=>[h(u(e.saveError),1)]),_:1})):_("",!0)]),_:1}),r(V,{class:"justify-center pb-4"},{default:a(()=>[r(m,{color:"red",onClick:l.cancel,variant:"flat",class:"mx-2"},{default:a(()=>[...t[7]||(t[7]=[i("span",{style:{color:"white"}},"Cancel",-1)])]),_:1},8,["onClick"]),r(m,{color:"blue",onClick:l.save,variant:"flat",class:"mx-2"},{default:a(()=>[...t[8]||(t[8]=[i("span",{style:{color:"white"}},"Update/Save",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})])}const G=M(B,[["render",D],["__scopeId","data-v-b50723e5"]]);export{G as default};
